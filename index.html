<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bible App by Yel Portillo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 50px;
      background-color: #f4f4f4;
    }
    #container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 600px;
      margin: auto;
      position: relative;
    }
    img {
      width: 100%;
      height: auto;
      border-radius: 10px;
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      background-color: #4caf50;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    .menu {
      position: absolute;
      top: 10px;
      right: 20px;
      cursor: pointer;
      font-size: 24px;
      user-select: none;
    }
    .menu-items {
      display: none;
      position: absolute;
      top: 40px;
      right: 20px;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      border-radius: 5px;
      list-style: none;
      padding: 10px;
      width: 150px;
      z-index: 10;
    }
    .menu-items li {
      padding: 10px;
      cursor: pointer;
      text-align: left;
      user-select: none;
    }
    .menu-items li:hover {
      background: #f0f0f0;
    }
    .tab {
      display: none;
      margin-top: 30px;
    }
    .active {
      display: block;
    }
    #prayer-list {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
      max-height: 400px;
      overflow-y: auto;
    }
    .prayer-item {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 8px;
      margin-top: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      text-align: center;
      width: 90%;
      max-width: 500px;
      word-wrap: break-word;
    }
    #prayerTab input,
    #prayerTab textarea {
      width: 100%;
      max-width: 500px;
      display: block;
      margin: 0 auto 10px auto;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      text-align: left;
      box-sizing: border-box;
      font-size: 14px;
    }
    #prayerTab #container {
      width: 95%;
      max-width: 600px;
      margin: auto;
      padding: 20px;
    }
    @media screen and (max-width: 480px) {
      #prayerTab input,
      #prayerTab textarea {
        width: 90%;
        margin: 0 auto;
      }
    }
  </style>
</head>
<body>
  <div id="container">
    <div class="menu" onclick="toggleMenu()">â˜°</div>
    <ul class="menu-items" id="menu-items">
      <li onclick="switchTab('verseTab')">Verse of the Day</li>
      <li onclick="switchTab('prayerTab')">Prayer Wall</li>
    </ul>

    <!-- Verse of the Day -->
    <div id="verseTab" class="tab active">
      <h2>Verse of the Day</h2>
      <p id="date"></p>
      <p id="verse" style="font-weight:bold; font-size: 18px;"></p>
      <img src="https://raw.githubusercontent.com/yelportillo/verseoftheday/main/media/bible.jpeg" alt="Bible Image" />
      <button onclick="generateVerse()">Generate New Verse</button>
    </div>

    <!-- Prayer Wall -->
    <div id="prayerTab" class="tab">
      <h2>Prayer Wall</h2>
      <input type="text" id="name" placeholder="Your Name (Optional)" />
      <textarea id="prayerInput" placeholder="Write your prayer here..." rows="5"></textarea>
      <button id="submitPrayer">Submit Prayer</button>
      <div id="prayer-list"></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

    // REPLACE with your Firebase config:
    const firebaseConfig = {
      apiKey: "AIzaSyBFAN4AUuoKtnyqR9I558Pjzznj8Me3io0",
      authDomain: "bible-app-7d43d.firebaseapp.com",
      databaseURL: "https://bible-app-7d43d-default-rtdb.firebaseio.com",
      projectId: "bible-app-7d43d",
      storageBucket: "bible-app-7d43d.appspot.com",
      messagingSenderId: "201267074022",
      appId: "1:201267074022:web:925599a081b283c2bdbc27"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Books and chapters count for random verse generation
    const booksAndChapters = {
      Genesis: 50, Exodus: 40, Leviticus: 27, Numbers: 36, Deuteronomy: 34,
      Joshua: 24, Judges: 21, Ruth: 4, "1 Samuel": 31, "2 Samuel": 24,
      "1 Kings": 22, "2 Kings": 25, "1 Chronicles": 29, "2 Chronicles": 36,
      Ezra: 10, Nehemiah: 13, Esther: 10, Job: 42, Psalms: 150, Proverbs: 31,
      Ecclesiastes: 12, Song: 8, Isaiah: 66, Jeremiah: 52, Lamentations: 5,
      Ezekiel: 48, Daniel: 12, Hosea: 14, Joel: 3, Amos: 9,
      Obadiah: 1, Jonah: 4, Micah: 7, Nahum: 3, Habakkuk: 3,
      Zephaniah: 3, Haggai: 2, Zechariah: 14, Malachi: 4,
      Matthew: 28, Mark: 16, Luke: 24, John: 21,
      Acts: 28, Romans: 16, "1 Corinthians": 16, "2 Corinthians": 13,
      Galatians: 6, Ephesians: 6, Philippians: 4, Colossians: 4,
      "1 Thessalonians": 5, "2 Thessalonians": 3,
      "1 Timothy": 6, "2 Timothy": 4, Titus: 3, Philemon: 1,
      Hebrews: 13, James: 5, "1 Peter": 5, "2 Peter": 3,
      "1 John": 5, "2 John": 1, "3 John": 1, Jude: 1, Revelation: 22
    };

    // Toggle menu
    window.toggleMenu = () => {
      const menu = document.getElementById("menu-items");
      menu.style.display = menu.style.display === "block" ? "none" : "block";
    };

    // Switch between tabs
    window.switchTab = (tabId) => {
      document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
      document.getElementById(tabId).classList.add("active");
      document.getElementById("menu-items").style.display = "none";
    };

    // Show current date
    window.displayDate = () => {
      const today = new Date();
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      document.getElementById("date").innerText = today.toLocaleDateString("en-US", options);
    };

    // Generate a random verse from the Bible API
    async function generateRandomVerse() {
      const books = Object.keys(booksAndChapters);
      const randomBook = books[Math.floor(Math.random() * books.length)];
      const maxChapters = booksAndChapters[randomBook];
      const randomChapter = Math.floor(Math.random() * maxChapters) + 1;

      try {
        const response = await fetch(`https://bible-api.com/${randomBook} ${randomChapter}`);
        const data = await response.json();

        if (!data || !data.verses || data.verses.length === 0) {
          document.getElementById("verse").innerText = "Verse not found, try again.";
          return;
        }

        const randomVerse = data.verses[Math.floor(Math.random() * data.verses.length)];
        document.getElementById("verse").innerText = `${randomBook} ${randomChapter}:${randomVerse.verse} - ${randomVerse.text.trim()}`;
      } catch (error) {
        document.getElementById("verse").innerText = "Error fetching verse. Please try again.";
        console.error(error);
      }
    }

    // Button handler
    window.generateVerse = () => {
      generateRandomVerse();
    };

    // Submit a prayer to Firebase Realtime Database
    const submitBtn = document.getElementById("submitPrayer");
    submitBtn.addEventListener("click", () => {
      const nameInput = document.getElementById("name").value.trim();
      const prayerInput = document.getElementById("prayerInput").value.trim();

      if (prayerInput === "") {
        alert("Please enter a prayer before submitting.");
        return;
      }

      const name = nameInput === "" ? "Anonymous" : nameInput;
      const now = new Date();

      // Format date and time
      const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
      const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };

      const datePosted = now.toLocaleDateString("en-US", dateOptions);
      const timePosted = now.toLocaleTimeString("en-US", timeOptions);

      // Prayer data object
      const prayerEntry = {
        name: name,
        prayer: prayerInput,
        date: datePosted,
        time: timePosted
      };

      // Push to Firebase
      const prayersRef = ref(db, 'prayers');
      push(prayersRef, prayerEntry)
        .then(() => {
          document.getElementById("name").value = "";
          document.getElementById("prayerInput").value = "";
        })
        .catch(err => {
          alert("Error submitting prayer: " + err);
        });
    });

    // Display prayers live from Firebase
    function displayPrayers() {
      const prayerList = document.getElementById("prayer-list");
      const prayersRef = ref(db, 'prayers');

      onValue(prayersRef, (snapshot) => {
        prayerList.innerHTML = "";
        const data = snapshot.val();
        if (!data) return;

        // Convert object to array sorted by newest first
        const prayersArray = Object.entries(data)
          .map(([key, val]) => val)
          .sort((a,b) => {
            // Sort by date/time descending
            const dateA = new Date(a.date + " " + a.time);
            const dateB = new Date(b.date + " " + b.time);
            return dateB - dateA;
          });

        prayersArray.forEach(prayer => {
          const prayerItem = document.createElement("div");
          prayerItem.classList.add("prayer-item");
          prayerItem.innerHTML = `<strong>${prayer.name}</strong><br>${prayer.prayer}<br><small>${prayer.date} at ${prayer.time}</small>`;
          prayerList.appendChild(prayerItem);
        });
      });
    }

    window.onload = () => {
      displayDate();
      generateVerse();
      displayPrayers();
    };
  </script>
</body>
</html>
