<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bible App by Yel Portillo</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4;
    }

    #container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      max-width: 600px;
      margin: 40px auto;
      position: relative;
    }

    h2 {
      margin-bottom: 5px;
      color: #333;
    }

    img {
      width: 100%;
      height: auto;
      border-radius: 10px;
      margin-top: 10px;
    }

    button {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      background-color: #4caf50;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.2s;
    }

    button:hover {
      background-color: #3e8e41;
    }

    .menu {
      position: absolute;
      top: 10px;
      right: 20px;
      cursor: pointer;
      font-size: 24px;
      user-select: none;
    }

    .menu-items {
      display: none;
      position: absolute;
      top: 40px;
      right: 20px;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      border-radius: 5px;
      list-style: none;
      padding: 10px;
      width: 150px;
      z-index: 10;
    }

    .menu-items li {
      padding: 10px;
      cursor: pointer;
      text-align: left;
      font-size: 14px;
      color: #333;
    }

    .menu-items li:hover {
      background: #f0f0f0;
    }

    .tab {
      display: none;
      margin-top: 20px;
    }

    .active {
      display: block;
    }

    #verse {
      white-space: pre-line;
      font-weight: normal;
      font-size: 18px;
      margin: 20px auto 5px;
      color: #222;
      max-width: 90%;
    }

    #prayer {
      font-style: italic;
      color: #666;
      max-width: 90%;
      margin: 10px auto 20px;
      font-size: 15px;
      line-height: 1.4;
    }

    #prayer-list {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
      max-height: 400px;
      overflow-y: auto;
      padding: 0 10px;
    }

    .prayer-item {
      background: #f9f9f9;
      padding: 12px;
      border-radius: 8px;
      margin-top: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.08);
      text-align: left;
      width: 100%;
      max-width: 500px;
      font-size: 14px;
      line-height: 1.4;
    }

    .prayer-item small {
      color: #888;
      font-size: 12px;
      display: block;
      margin-top: 5px;
    }

    #prayerTab input,
    #prayerTab textarea {
      width: 100%;
      max-width: 500px;
      display: block;
      margin: 10px auto;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 14px;
    }

    @media screen and (max-width: 480px) {
      #prayerTab input,
      #prayerTab textarea {
        width: 90%;
      }
    }
  </style>
</head>
<body>
  <div id="container">
    <div class="menu" id="menu-btn">â˜°</div>
    <ul class="menu-items" id="menu-items">
      <li data-tab="verseTab">Verse of the Day</li>
      <li data-tab="prayerTab">Prayer Wall</li>
    </ul>

    <!-- Verse Tab -->
    <div id="verseTab" class="tab active">
      <h2>Verse of the Day</h2>
      <p id="date"></p>
      <p id="verse">Loading verse...</p>
      <p id="prayer"></p>
      <img src="https://raw.githubusercontent.com/yelportillo/verseoftheday/main/media/bible.jpeg" alt="Bible Image" />
      <button id="new-verse">Generate New Verse</button>
    </div>

    <!-- Prayer Tab -->
    <div id="prayerTab" class="tab">
      <h2>Prayer Wall</h2>
      <input type="text" id="name" placeholder="Your Name (Optional)" />
      <textarea id="prayerInput" placeholder="Write your prayer here..." rows="4"></textarea>
      <button id="submitPrayer">Submit Prayer</button>
      <div id="prayer-list"></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBFAN4AUuoKtnyqR9I558Pjzznj8Me3io0",
      authDomain: "bible-app-7d43d.firebaseapp.com",
      databaseURL: "https://bible-app-7d43d-default-rtdb.firebaseio.com",
      projectId: "bible-app-7d43d",
      storageBucket: "bible-app-7d43d.appspot.com",
      messagingSenderId: "201267074022",
      appId: "1:201267074022:web:925599a081b283c2bdbc27"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Menu
    const menuBtn = document.getElementById("menu-btn");
    const menuItems = document.getElementById("menu-items");

    menuBtn.addEventListener("click", () => {
      menuItems.style.display = menuItems.style.display === "block" ? "none" : "block";
    });

    menuItems.querySelectorAll("li").forEach(item => {
      item.addEventListener("click", () => {
        document.querySelectorAll(".tab").forEach(tab => tab.classList.remove("active"));
        document.getElementById(item.dataset.tab).classList.add("active");
        menuItems.style.display = "none";
      });
    });

    // Date
    document.getElementById("date").innerText = new Date().toLocaleDateString("en-US", { 
      weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
    });

    // Books to pull random verses from
    const booksAndChapters = {
      Psalms: 150, Proverbs: 31, Matthew: 28, John: 21, Romans: 16, Isaiah: 66, Philippians: 4
    };

    const prayers = {
      faith: [
        "Lord, strengthen my faith and keep my heart steadfast in Your promises. Amen.",
        "Father, help me trust in You even when I cannot see the way ahead. Amen."
      ],
      peace: [
        "Jesus, calm my spirit and fill me with Your peace that surpasses understanding. Amen.",
        "Lord, in the chaos, be my stillness and comfort. Amen."
      ],
      strength: [
        "God, give me the strength to face each challenge with courage. Amen.",
        "Lord, be my rock and my refuge in every trial. Amen."
      ],
      guidance: [
        "Father, lead me on the path of righteousness and keep me from straying. Amen.",
        "Holy Spirit, direct my steps and grant me wisdom in every decision. Amen."
      ],
      love: [
        "Lord, help me to love others as You have loved me. Amen.",
        "Father, fill me with compassion and grace towards everyone I meet. Amen."
      ]
    };

    async function generateVerse() {
      const books = Object.keys(booksAndChapters);
      const book = books[Math.floor(Math.random() * books.length)];
      const chapter = Math.floor(Math.random() * booksAndChapters[book]) + 1;

      try {
        const res = await fetch(`https://bible-api.com/${book} ${chapter}`);
        const data = await res.json();

        if (!data.verses) return;

        const verse = data.verses[Math.floor(Math.random() * data.verses.length)];
        document.getElementById("verse").innerText = `${book} ${chapter}:${verse.verse}\n\n${verse.text.trim()}`;

        const text = verse.text.toLowerCase();
        let category = "faith";
        if (text.includes("peace")) category = "peace";
        else if (text.includes("love")) category = "love";
        else if (text.includes("strength") || text.includes("courage")) category = "strength";
        else if (text.includes("guide") || text.includes("wisdom")) category = "guidance";

        const prayerList = prayers[category];
        document.getElementById("prayer").innerText = prayerList[Math.floor(Math.random() * prayerList.length)];
      } catch {
        document.getElementById("verse").innerText = "Failed to load verse.";
        document.getElementById("prayer").innerText = "";
      }
    }

    document.getElementById("new-verse").addEventListener("click", generateVerse);

    // Prayer Wall
    function displayPrayers() {
      const prayerList = document.getElementById("prayer-list");
      const prayersRef = ref(db, 'prayers');

      onValue(prayersRef, (snapshot) => {
        prayerList.innerHTML = "";
        const data = snapshot.val();
        if (!data) return;

        const prayersArray = Object.values(data).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        prayersArray.forEach(prayer => {
          const dt = new Date(prayer.timestamp);
          const item = document.createElement("div");
          item.className = "prayer-item";
          item.innerHTML = `
            <div>${prayer.name || "Anonymous"}</div>
            <div>${prayer.prayer}</div>
            <small>${dt.toLocaleDateString()} ${dt.toLocaleTimeString()}</small>
          `;
          prayerList.appendChild(item);
        });
      });
    }

    document.getElementById("submitPrayer").addEventListener("click", () => {
      const name = document.getElementById("name").value.trim() || "Anonymous";
      const prayer = document.getElementById("prayerInput").value.trim();

      if (!prayer) {
        alert("Please enter a prayer.");
        return;
      }

      push(ref(db, "prayers"), {
        name,
        prayer,
        timestamp: new Date().toISOString()
      });

      document.getElementById("name").value = "";
      document.getElementById("prayerInput").value = "";
    });

    window.onload = () => {
      generateVerse();
      displayPrayers();
    };
  </script>
</body>
</html>
