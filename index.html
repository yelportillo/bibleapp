<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bible App</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      background-color: #f9f9f9;
      margin: 40px;
      color: #222;
    }
    #container {
      background: white;
      max-width: 600px;
      margin: auto;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgb(0 0 0 / 0.1);
      position: relative;
    }
    h2 {
      font-weight: 700;
      margin-bottom: 15px;
      color: #333;
    }
    #verseTitle {
      font-weight: 700;
      margin-bottom: 8px;
      font-size: 20px;
    }
    #verse {
      font-weight: normal;
      font-size: 18px;
      margin-bottom: 12px;
      color: #444;
    }
    #prayer {
      font-style: italic;
      color: #666;
      margin-bottom: 18px;
      white-space: pre-wrap;
    }
    img {
      width: 100%;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    button {
      cursor: pointer;
      padding: 12px 28px;
      background-color: #4caf50;
      border: none;
      color: white;
      font-size: 17px;
      border-radius: 7px;
      transition: background-color 0.3s ease;
      margin-bottom: 25px;
    }
    button:hover {
      background-color: #429642;
    }
    #date {
      font-size: 14px;
      color: #888;
      margin-bottom: 20px;
    }
    #prayerWallTitle {
      font-weight: 700;
      font-size: 22px;
      margin-bottom: 20px;
      margin-top: 40px;
      color: #333;
    }
    #prayerInput, #nameInput {
      width: 90%;
      max-width: 500px;
      padding: 12px 15px;
      font-size: 16px;
      margin-bottom: 12px;
      border: 1.5px solid #ccc;
      border-radius: 8px;
      resize: vertical;
      outline: none;
      box-sizing: border-box;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    #prayer-list {
      max-width: 550px;
      margin: 20px auto 0 auto;
      text-align: left;
    }
    .prayer-item {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 9px;
      padding: 15px 20px;
      margin-bottom: 15px;
      box-shadow: 0 1px 6px rgb(0 0 0 / 0.07);
      word-wrap: break-word;
      white-space: pre-wrap;
    }
    .prayer-item .name {
      font-weight: 600;
      margin-bottom: 6px;
      color: #333;
    }
    .prayer-item .datetime {
      font-size: 12px;
      color: #999;
      margin-top: 8px;
      font-style: normal;
    }
  </style>
</head>
<body>
  <div id="container">
    <h2>Verse of the Day</h2>
    <div id="date"></div>
    <div id="verseTitle"></div>
    <div id="verse">Loading verse...</div>
    <div id="prayer"></div>
    <img id="bible-image" src="media/bible.jpeg" alt="Bible Image" />
    <button onclick="fetchRandomVerse()">Generate New Verse</button>

    <h2 id="prayerWallTitle">Prayer Wall</h2>
    <input type="text" id="nameInput" placeholder="Your Name (Optional)" />
    <textarea id="prayerInput" rows="4" placeholder="Write your prayer here..."></textarea>
    <button onclick="submitPrayer()">Submit Prayer</button>
    <div id="prayer-list"></div>
  </div>

<script>
  // Books & chapters map (partial for demo; add more if you want)
  const bibleBooks = {
    "Genesis": 50,
    "Exodus": 40,
    "Psalms": 150,
    "John": 21,
    "Romans": 16,
    "Matthew": 28,
    "Luke": 24,
    "Revelation": 22
  };

  function randInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  // Generate simple prayer endings based on input number
  function generatePrayer(seed) {
    const prayers = [
      "Lord, guide my heart and strengthen my faith. Amen.",
      "God, please bless and keep me safe. Amen.",
      "Father, thank You for Your unfailing love. Amen.",
      "Jesus, help me walk in Your light. Amen.",
      "Holy Spirit, fill me with Your peace. Amen."
    ];
    return prayers[seed % prayers.length];
  }

  // Display current date nicely
  function displayDate() {
    const today = new Date();
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById("date").textContent = today.toLocaleDateString("en-US", options);
  }

  async function fetchRandomVerse(retryCount = 3) {
    const verseEl = document.getElementById("verse");
    const prayerEl = document.getElementById("prayer");
    const verseTitleEl = document.getElementById("verseTitle");

    verseEl.textContent = "Loading verse...";
    prayerEl.textContent = "";
    verseTitleEl.textContent = "";

    for (let attempt = 1; attempt <= retryCount; attempt++) {
      try {
        const books = Object.keys(bibleBooks);
        const book = books[randInt(0, books.length -1)];
        const chapter = randInt(1, bibleBooks[book]);
        const url = `https://bible-api.com/${encodeURIComponent(book)}%20${chapter}`;

        const response = await fetch(url);
        if (!response.ok) throw new Error(`API response not OK`);

        const data = await response.json();

        if (!data.verses || data.verses.length === 0) throw new Error("No verses found");

        const verseIndex = randInt(0, data.verses.length - 1);
        const verseObj = data.verses[verseIndex];

        // Verse text, without bold
        const verseText = `${book} ${verseObj.chapter}:${verseObj.verse} - ${verseObj.text.trim()}`;
        verseTitleEl.textContent = "Verse:";
        verseEl.textContent = verseText;

        // Related prayer based on length mod prayers count
        prayerEl.textContent = generatePrayer(verseObj.text.length);

        // Image is static local
        document.getElementById('bible-image').src = "media/bible.jpeg";

        // Success â€” exit function
        return;

      } catch(err) {
        console.warn(`Attempt ${attempt} failed: ${err.message}`);
        if (attempt === retryCount) {
          verseTitleEl.textContent = "";
          verseEl.textContent = "Sorry, failed to load verse. Please try again.";
          prayerEl.textContent = "";
        }
      }
    }
  }

  function submitPrayer() {
    const nameInput = document.getElementById("nameInput").value.trim();
    const prayerInput = document.getElementById("prayerInput").value.trim();

    if (!prayerInput) {
      alert("Please enter a prayer before submitting.");
      return;
    }

    const name = nameInput || "Anonymous";
    const now = new Date();

    const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
    const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };

    const datePosted = now.toLocaleDateString("en-US", dateOptions);
    const timePosted = now.toLocaleTimeString("en-US", timeOptions);

    const prayerEntry = {
      name: name,
      prayer: prayerInput,
      date: datePosted,
      time: timePosted
    };

    let prayers = JSON.parse(localStorage.getItem("prayers")) || [];
    prayers.unshift(prayerEntry);
    localStorage.setItem("prayers", JSON.stringify(prayers));

    displayPrayers();

    document.getElementById("nameInput").value = "";
    document.getElementById("prayerInput").value = "";
  }

  function displayPrayers() {
    const prayerList = document.getElementById("prayer-list");
    prayerList.innerHTML = "";

    let prayers = JSON.parse(localStorage.getItem("prayers")) || [];

    prayers.forEach(p => {
      const div = document.createElement("div");
      div.className = "prayer-item";
      div.innerHTML = `
        <div class="name">${p.name}</div>
        <div class="prayer-text">${p.prayer}</div>
        <div class="datetime">${p.date} at ${p.time}</div>
      `;
      prayerList.appendChild(div);
    });
  }

  // Initial setup
  window.onload = function() {
    displayDate();
    fetchRandomVerse();
    displayPrayers();
  };
</script>
</body>
</html>
